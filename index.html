
<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<title>MEET EDC IN TORONTO</title>
<!-- for-mobile-apps -->
<script src="https://js.stripe.com/v3/"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Payment Form Widget Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
		function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //for-mobile-apps -->
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<link href='//fonts.googleapis.com/css?family=Fugaz+One' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Alegreya+Sans:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,800,800italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script>
	var PUBLIC_CODE = ''
	var IS_CODE_VALID = false
	var PRICE = 99
</script>
</head>
<body>
	<div class="main">
		<div class="content">
			
			<script src="js/easyResponsiveTabs.js" type="text/javascript"></script>
					<script type="text/javascript">
						$(document).ready(function () {
							$('#horizontalTab').easyResponsiveTabs({
								type: 'default', //Types: default, vertical, accordion           
								width: 'auto', //auto or any width like 600px
								fit: true   // 100% fit in a container
							});
						});
						
					</script>
						<div class="sap_tabs">
							<div id="horizontalTab" style="display: block; width: 100%; margin: 0px;">
								
								<div class="resp-tabs-container1" style="background-color:rgba(255, 255, 255, 0.8)">
									<div class="tab-1 resp-tab-content1">
										<div class="payment-info">
											<h3>Personal Information</h3>
											<form>
												<div class="tab-for">				
													<h5>EMAIL ADDRESS</h5>
														<input id="email" type="text" value="">
													<h5>CONFIRM EMAIL ADDRESS</h5>													
														<input id="confirmedEmail" type="text" value="">
												</div>			
											</form>
											<h3 class="pay-title">Credit Card Info</h3>
											<!--asdasdas-->
											<form method="post" id="payment-form">
												  <div class="form-row">
												    
														<div class="l-wrapper" id="loading" style="display:none;">
														    <svg viewBox="0 0 120 120" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
														      <g id="circle" class="g-circles g-circles--v1">
														          <circle id="12" transform="translate(35, 16.698730) rotate(-30) translate(-35, -16.698730) " cx="35" cy="16.6987298" r="10"></circle>
														          <circle id="11" transform="translate(16.698730, 35) rotate(-60) translate(-16.698730, -35) " cx="16.6987298" cy="35" r="10"></circle>
														          <circle id="10" transform="translate(10, 60) rotate(-90) translate(-10, -60) " cx="10" cy="60" r="10"></circle>
														          <circle id="9" transform="translate(16.698730, 85) rotate(-120) translate(-16.698730, -85) " cx="16.6987298" cy="85" r="10"></circle>
														          <circle id="8" transform="translate(35, 103.301270) rotate(-150) translate(-35, -103.301270) " cx="35" cy="103.30127" r="10"></circle>
														          <circle id="7" cx="60" cy="110" r="10"></circle>
														          <circle id="6" transform="translate(85, 103.301270) rotate(-30) translate(-85, -103.301270) " cx="85" cy="103.30127" r="10"></circle>
														          <circle id="5" transform="translate(103.301270, 85) rotate(-60) translate(-103.301270, -85) " cx="103.30127" cy="85" r="10"></circle>
														          <circle id="4" transform="translate(110, 60) rotate(-90) translate(-110, -60) " cx="110" cy="60" r="10"></circle>
														          <circle id="3" transform="translate(103.301270, 35) rotate(-120) translate(-103.301270, -35) " cx="103.30127" cy="35" r="10"></circle>
														          <circle id="2" transform="translate(85, 16.698730) rotate(-150) translate(-85, -16.698730) " cx="85" cy="16.6987298" r="10"></circle>
														          <circle id="1" cx="60" cy="10" r="10"></circle>
														      </g>

														      <use xlink:href="#circle" class="use"/>
														  </svg>

														</div>




												    <div id="card-element">
												      <!-- a Stripe Element will be inserted here. -->
												    </div>

												    <!-- Used to display form errors -->
												    <div id="card-errors" role="alert"></div>
												  </div>
												  <br/>
												  <div class="tab-form-left user-form">
														<h5>TICKET NUMBER</h5>
															<ul>
																<li>
																	<input id="ticketNumber" type="number" class="text_box" type="text" value="1" min="1" />	
																</li>
															</ul>
													</div>
													<div class="tab-form-right user-form-rt">
														<h5>PRICE</h5>
														<input id="price" type="text" value="111.87(C$99 for each + TAX)" disabled="disabled">
														
													</div>
													<div class="tab-form-left user-form">
														<h5><br/>*PROMOTIONAL CODE</h5>
														<input id="code" type="text" value="" placeholder="enter code to get discount">														
													</div>													
													<button type="button" class="submitButton" id="verifyButton">VERIFY CODE</button>
												  	<button  style="float:right" type="button" class="submitButton" id="buyButton">PAY NOW</button>
												</form>
												<script type="text/javascript">
													// Create a Stripe client
													var stripe = Stripe('pk_live_GYG3dqnZhlXTtu97cr2Bo3rK');

													console.log("HEY")

													// Create an instance of Elements
													var elements = stripe.elements();

													// Custom styling can be passed to options when creating an Element.
													console.log("HEY2")
													// (Note that this demo uses a wider set of styles than the guide below.)
													var style = {
													  base: {
													    color: '#32325d',
													    lineHeight: '24px',
													    fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
													    fontSmoothing: 'antialiased',
													    fontSize: '16px',
													    '::placeholder': {
													      color: '#aab7c4'
													    }
													  },
													  invalid: {
													    color: '#fa755a',
													    iconColor: '#fa755a'
													  }
													};

													// Create an instance of the card Element
													var card = elements.create('card', {style: style});

													// Add an instance of the card Element into the `card-element` <div>
													card.mount('#card-element');

													// Handle real-time validation errors from the card Element.
													console.log("HEY3")
													card.addEventListener('change', function(event) {
														console.log("HEY4")
													  var displayError = document.getElementById('card-errors');
													  if (event.error) {
													    displayError.textContent = event.error.message;
													  } else {
													    displayError.textContent = '';
													  }
													});

													// Handle form submission
													var form = document.getElementById('payment-form');
												
													document.getElementById('buyButton').onclick = buyButtonClicked
													document.getElementById('verifyButton').onclick = verifyCodeClicked

													function buyButtonClicked (){
													  console.log("HEY5")
													  document.getElementById('buyButton').disabled=true;
													  document.getElementById('loading').style.display = 'block'
													  var validation = validateEmail()
													  if (validation == true){													
														  stripe.createToken(card).then(function(result) {
														    if (result.error) {
														      document.getElementById('buyButton').disabled=false;
														      document.getElementById('loading').style.display = 'none'
														      // Inform the user if there was an error
														      var errorElement = document.getElementById('card-errors');
														      errorElement.textContent = result.error.message;
														      console.log("token is failed to created")
														      alert("购票失败，请稍后再试")
														    } else {
														      // Send the token to your server
														      console.log("HEY6")
														      console.log(result.token)
														      stripeTokenHandler(result.token);
														    }
														  });
														  	
														  
													  }
													  else{
													  	document.getElementById('loading').style.display = 'none'
													  	document.getElementById('buyButton').disabled=false;
													  }
													  
													}
													function stripeTokenHandler(token) {
														console.log("im in!");
														var email = $("#email").val()
														console.log(email)
														var ticketNumber = $("#ticketNumber").val()
														//alert(ticketNumber)

														$.post("https://haoyizu.herokuapp.com/ticket/purchase", {token: token.id, id: "web", amount: ticketNumber, wechat: "web", ticketNumber: ticketNumber, email: email, isCodeValid: IS_CODE_VALID, code: PUBLIC_CODE}, function(result, err){
														//$.post("https://haoyizu.herokuapp.com/ticket/purchase", {token: token.id, id: "web", amount: ticketNumber, wechat: "web", ticketNumber: ticketNumber, email: email, isCodeValid: IS_CODE_VALID, code: PUBLIC_CODE}, function(result, err){

															console.log(result)
															console.log(err)
															console.log("DONE!")
															alert("付款成功，请等待电子票发送至您的邮箱")
															document.getElementById('buyButton').disabled=false;
															document.getElementById('loading').style.display = 'none'

													    }).error(function () {
													    	document.getElementById('buyButton').disabled=false;
													    	document.getElementById('loading').style.display = 'none'
													    	alert("付款失败，请联系客服人员")

													    });
														
													}

													function validateEmail(){
														var email = $("#email").val()
														var confirmedEmail = $("#confirmedEmail").val()
														if (email == ''){
															alert("Please fill in the email address first")
															return false
														}
														if (email != confirmedEmail){
															alert("make sure the email addresses are same")
															return false
														}
														return true
													}

													var ticketNumber = document.getElementById("ticketNumber")
													var price = document.getElementById("price")

													ticketNumber.addEventListener('change', function(event) {
														console.log("ticketNumber changed")
														price.value = '' + (ticketNumber.value*PRICE*1.13).toFixed(2) + '(C$' + PRICE + ' for each + TAX)'
													});

													function verifyCodeClicked(){
														console.log('aaa')
														var code = document.getElementById('code').value
														console.log(code)
														/*
														$.post("https://haoyizu.herokuapp.com/ticket/purchase", {token: token.id, id: "web", amount: ticketNumber, wechat: "web", ticketNumber: ticketNumber, email: email}, function(result, err){

															console.log(result)
															console.log(err)
															console.log("DONE!")
															alert("付款成功，请等待电子票发送至您的邮箱")
															document.getElementById('buyButton').disabled=false;
															document.getElementById('loading').style.display = 'none'

													    }).error(function () {alert("付款失败，请联系客服人员")});
														*/
														
														$.post("https://haoyizu.herokuapp.com/code/verify", {code: code}, function(result, err){
															console.log(result.isVerified)
															console.log(result.isValid)
															if(result.isVerified){
																if (result.isValid){
																	alert("此CODE已验证成功，票价为C$79")
																	PUBLIC_CODE = code
																	IS_CODE_VALID = true
																	PRICE = 79
																	var ticketNumber = document.getElementById("ticketNumber")
																	var price = document.getElementById("price")
																	price.value = '' + (ticketNumber.value*PRICE*1.13).toFixed(2) + '(C$' + PRICE + ' for each + TAX)'
																}
																else{
																	alert("此CODE无效")
																}
															}
															
													    }).error(function () {alert("验证失败")});
													}
												</script>
												<!--asdasdas-->
											
										</div>
									</div>
									
								</div>	
								<div align="center">
									<br/>
								<img src="images/assistant.png"/  width="30%">
								<br/>
								<div><font color="#FFFFFF">如果有任何问题，请加微信助手</font></div>
								</div>

							</div>
						</div>	

		</div>
	</div>
</body>
</html>